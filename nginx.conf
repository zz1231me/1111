# nginx ì„¤ì • íŒŒì¼ (C:\nginx\conf\nginx.conf)
# Express API ì„œë²„ì™€ ì—°ë™í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ + API ì„œë¹™

# ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ ìˆ˜ (CPU ì½”ì–´ ìˆ˜ì™€ ë§ì¶”ëŠ” ê²ƒì´ ì¼ë°˜ì )
worker_processes  1;

# ì´ë²¤íŠ¸ ë¸”ë¡ - ì—°ê²° ì²˜ë¦¬ ì„¤ì •
events {
    worker_connections  1024;  # ì›Œì»¤ë‹¹ ìµœëŒ€ ë™ì‹œ ì—°ê²° ìˆ˜
}

# HTTP ë¸”ë¡ - ì›¹ì„œë²„ ë©”ì¸ ì„¤ì •
http {
    # MIME íƒ€ì… ì„¤ì • í¬í•¨
    include       mime.types;
    default_type  application/octet-stream;
    
    # íŒŒì¼ ì „ì†¡ ìµœì í™”
    sendfile        on;
    keepalive_timeout  65;
    
    # ì—…ë¡œë“œ íŒŒì¼ í¬ê¸° ì œí•œ (100MBê¹Œì§€ í—ˆìš©)
    client_max_body_size 100m;
    
    # ========================================
    # ì„±ëŠ¥ ìµœì í™” ì˜µì…˜ (http ë¸”ë¡ ë ˆë²¨)
    # ========================================
    
    # gzip ì••ì¶• í™œì„±í™” (ëŒ€ì—­í­ ì ˆì•½)
    gzip on;
    gzip_vary on;
    gzip_min_length 1000;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;
    
    # ë©”ì¸ ì„œë²„ ë¸”ë¡
    server {
        # 80í¬íŠ¸ì—ì„œ ìˆ˜ì‹ 
        listen       80;
        server_name  localhost;
        
        # ========================================
        # ğŸ”§ ì¤‘ìš”: ì—…ë¡œë“œ íŒŒì¼ ë¨¼ì € ì²˜ë¦¬ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)
        # ========================================
        location /uploads/ {
            alias C:/jamtori/server/uploads/;
            expires 1y;
            add_header Cache-Control "public, immutable";
            try_files $uri =404;
        }
        
        # ========================================
        # API í”„ë¡ì‹œ (Express ì„œë²„ë¡œ ì „ë‹¬)
        # ========================================
        location /api/ {
            # Express API ì„œë²„(4000í¬íŠ¸)ë¡œ í”„ë¡ì‹œ
            proxy_pass http://127.0.0.1:4000/api/;
            
            # í”„ë¡ì‹œ í—¤ë” ì„¤ì • (í´ë¼ì´ì–¸íŠ¸ ì •ë³´ ì „ë‹¬)
            proxy_set_header Host $host;                    # í˜¸ìŠ¤íŠ¸ëª… ì „ë‹¬
            proxy_set_header X-Real-IP $remote_addr;        # ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ IP
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # í”„ë¡ì‹œ ì²´ì¸ IP
            proxy_set_header X-Forwarded-Proto $scheme;     # HTTP/HTTPS í”„ë¡œí† ì½œ
        }
        
        # ========================================
        # ğŸ”§ ìˆ˜ì •: í´ë¼ì´ì–¸íŠ¸ ì •ì  íŒŒì¼ë§Œ ìºì‹± (uploads ì œì™¸)
        # ========================================
        location ~* ^(?!/uploads/).*\.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ {
            root   C:/jamtori/client/dist;
            expires 1y;
            add_header Cache-Control "public, immutable";
            add_header Vary Accept-Encoding;
        }
        
        # ========================================
        # í´ë¼ì´ì–¸íŠ¸ ì •ì  íŒŒì¼ ì„œë¹™ (React ì•±)
        # ========================================
        location / {
            root   C:/jamtori/client/dist;
            index  index.html index.htm;
            
            # SPA(Single Page Application) ë¼ìš°íŒ… ì§€ì›
            # ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ë¡œëŠ” ëª¨ë‘ index.htmlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            try_files $uri $uri/ /index.html;
        }
        
        # ========================================
        # ì—ëŸ¬ í˜ì´ì§€ ì„¤ì •
        # ========================================
        # ì„œë²„ ì—ëŸ¬ ì‹œ í‘œì‹œí•  í˜ì´ì§€
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;  # C:\nginx\html\50x.html íŒŒì¼ ì‚¬ìš©
        }
    } # âœ… server ë¸”ë¡ ì¢…ë£Œ
} # âœ… http ë¸”ë¡ ì¢…ë£Œ

# ========================================
# ğŸ”§ ìˆ˜ì • ì‚¬í•­ ì„¤ëª…
# ========================================
#
# ë¬¸ì œ:
# - ì •ì  íŒŒì¼ ìºì‹± ì„¤ì •ì´ /uploads/ ê²½ë¡œì˜ ì´ë¯¸ì§€ë„ client/distì—ì„œ ì°¾ìŒ
# - nginx location ìš°ì„ ìˆœìœ„ ë•Œë¬¸ì— í™•ì¥ì ê¸°ë°˜ ì„¤ì •ì´ ë¨¼ì € ì ìš©ë¨
#
# í•´ê²°:
# 1. /uploads/ locationì„ ë§¨ ìœ„ë¡œ ì´ë™ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)
# 2. ì •ì  íŒŒì¼ ìºì‹±ì—ì„œ /uploads/ ê²½ë¡œ ì œì™¸ (ì •ê·œì‹ ì‚¬ìš©)
#
# ë™ì‘ íë¦„:
# - /uploads/images/test.jpg â†’ uploads location (ì„œë²„ íŒŒì¼)
# - /assets/index.js â†’ ì •ì  íŒŒì¼ ìºì‹± (í´ë¼ì´ì–¸íŠ¸ íŒŒì¼)
# - /api/* â†’ Express í”„ë¡ì‹œ
# - / â†’ React ì•±
#
# ========================================
