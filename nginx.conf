# nginx ì„¤ì • íŒŒì¼ (C:\nginx\conf\nginx.conf)
# Express API ì„œë²„ì™€ ì—°ë™í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ + API ì„œë¹™

# ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ ìˆ˜ (CPU ì½”ì–´ ìˆ˜ì™€ ë§ì¶”ëŠ” ê²ƒì´ ì¼ë°˜ì )
worker_processes  1;

# ì´ë²¤íŠ¸ ë¸”ë¡ - ì—°ê²° ì²˜ë¦¬ ì„¤ì •
events {
    worker_connections  1024;  # ì›Œì»¤ë‹¹ ìµœëŒ€ ë™ì‹œ ì—°ê²° ìˆ˜
}

# HTTP ë¸”ë¡ - ì›¹ì„œë²„ ë©”ì¸ ì„¤ì •
http {
    # MIME íƒ€ì… ì„¤ì • í¬í•¨
    include       mime.types;
    default_type  application/octet-stream;
    
    # íŒŒì¼ ì „ì†¡ ìµœì í™”
    sendfile        on;
    keepalive_timeout  65;
    
    # ì—…ë¡œë“œ íŒŒì¼ í¬ê¸° ì œí•œ (100MBê¹Œì§€ í—ˆìš©)
    client_max_body_size 100m;
    
    # ========================================
    # ì„±ëŠ¥ ìµœì í™” ì˜µì…˜ (http ë¸”ë¡ ë ˆë²¨)
    # ========================================
    
    # gzip ì••ì¶• í™œì„±í™” (ëŒ€ì—­í­ ì ˆì•½)
    gzip on;
    gzip_vary on;
    gzip_min_length 1000;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;
    
    # ë©”ì¸ ì„œë²„ ë¸”ë¡
    server {
        # 80í¬íŠ¸ì—ì„œ ìˆ˜ì‹ 
        listen       80;
        server_name  localhost;
        
        # ========================================
        # ì •ì  íŒŒì¼ ìºì‹± ì„¤ì • (âœ… server ë¸”ë¡ ì•ˆìœ¼ë¡œ ì´ë™)
        # ========================================
        location ~* \.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ {
            root   C:/jamtori/client/dist;  # âœ… ê²½ë¡œ ìˆ˜ì •
            expires 1y;  # 1ë…„ ìºì‹±
            add_header Cache-Control "public, immutable";
            add_header Vary Accept-Encoding;
        }
        
        # ========================================
        # ğŸ”§ ìˆ˜ì •ëœ ë¶€ë¶„: ì—…ë¡œë“œ íŒŒì¼ ì§ì ‘ ì„œë¹™ (í”„ë¡ì‹œ â†’ ì •ì  íŒŒì¼ ì„œë¹™)
        # ========================================
        location /uploads/ {
            # Express ì„œë²„ë¡œ í”„ë¡ì‹œí•˜ì§€ ì•Šê³  ì§ì ‘ ì •ì  íŒŒì¼ ì„œë¹™
            root C:/jamtori/server;  # C:/jamtori/server/uploads/ ê²½ë¡œê°€ ë¨
            expires 1y;
            add_header Cache-Control "public, immutable";
            
            # íŒŒì¼ì´ ì—†ìœ¼ë©´ 404 ë°˜í™˜
            try_files $uri =404;
        }
        
        # ========================================
        # API í”„ë¡ì‹œ (Express ì„œë²„ë¡œ ì „ë‹¬)
        # ========================================
        location /api/ {
            # Express API ì„œë²„(4000í¬íŠ¸)ë¡œ í”„ë¡ì‹œ
            proxy_pass http://127.0.0.1:4000/api/;
            
            # í”„ë¡ì‹œ í—¤ë” ì„¤ì • (í´ë¼ì´ì–¸íŠ¸ ì •ë³´ ì „ë‹¬)
            proxy_set_header Host $host;                    # í˜¸ìŠ¤íŠ¸ëª… ì „ë‹¬
            proxy_set_header X-Real-IP $remote_addr;        # ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ IP
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # í”„ë¡ì‹œ ì²´ì¸ IP
            proxy_set_header X-Forwarded-Proto $scheme;     # HTTP/HTTPS í”„ë¡œí† ì½œ
        }
        
        # ========================================
        # í´ë¼ì´ì–¸íŠ¸ ì •ì  íŒŒì¼ ì„œë¹™ (React ì•±)
        # ========================================
        location / {
            root   C:/jamtori/client/dist;  # âœ… ê²½ë¡œ ìˆ˜ì •
            index  index.html index.htm;
            
            # SPA(Single Page Application) ë¼ìš°íŒ… ì§€ì›
            # ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ë¡œëŠ” ëª¨ë‘ index.htmlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            try_files $uri $uri/ /index.html;
        }
        
        # ========================================
        # ì—ëŸ¬ í˜ì´ì§€ ì„¤ì •
        # ========================================
        # ì„œë²„ ì—ëŸ¬ ì‹œ í‘œì‹œí•  í˜ì´ì§€
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;  # C:\nginx\html\50x.html íŒŒì¼ ì‚¬ìš©
        }
    } # âœ… server ë¸”ë¡ ì¢…ë£Œ
} # âœ… http ë¸”ë¡ ì¢…ë£Œ

# ========================================
# ì„¤ì • ì„¤ëª… (ìˆ˜ì •ë¨)
# ========================================
#
# ë™ì‘ íë¦„:
# 1. ì‚¬ìš©ìê°€ http://localhost ë˜ëŠ” http://192.168.x.x ì ‘ì†
# 2. nginxê°€ ìš”ì²­ì„ ë°›ì•„ì„œ ì²˜ë¦¬:
#    - /          â†’ client/dist/index.html ì„œë¹™ (React ì•±)
#    - /api/*     â†’ Express(4000í¬íŠ¸) í”„ë¡ì‹œ (API ì²˜ë¦¬)
#    - /uploads/* â†’ nginxê°€ ì§ì ‘ C:/jamtori/server/uploads/ ì •ì  íŒŒì¼ ì„œë¹™ âœ…
# 3. ExpressëŠ” API ë¡œì§ê³¼ íŒŒì¼ ì—…ë¡œë“œë§Œ ì²˜ë¦¬
# 4. nginxëŠ” ì •ì  íŒŒì¼ ì„œë¹™ê³¼ í”„ë¡ì‹œ ì—­í•  ë‹´ë‹¹
#
# ğŸ”§ ë³€ê²½ì‚¬í•­:
# - /uploads/* ê²½ë¡œë¥¼ Express í”„ë¡ì‹œì—ì„œ nginx ì§ì ‘ ì •ì  íŒŒì¼ ì„œë¹™ìœ¼ë¡œ ë³€ê²½
# - ì´ì œ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ê°€ 404 ì—ëŸ¬ ì—†ì´ ì •ìƒ ë¡œë“œë¨
#
# ì¥ì :
# - nginx: ì •ì  íŒŒì¼ ì„œë¹™ ìµœì í™” (ì—…ë¡œë“œ íŒŒì¼ í¬í•¨)
# - Express: API ë¡œì§ì—ë§Œ ì§‘ì¤‘
# - í™•ì¥ì„±: ê°ê° ë…ë¦½ì ìœ¼ë¡œ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥
# - ì„±ëŠ¥: nginxì˜ ê³ ì„±ëŠ¥ ì •ì  íŒŒì¼ ì„œë¹™
#
# í¬íŠ¸ êµ¬ì¡°:
# - ì™¸ë¶€ ì ‘ì†: 80í¬íŠ¸ (nginx)
# - ë‚´ë¶€ API: 4000í¬íŠ¸ (Express, ë¡œì»¬í˜¸ìŠ¤íŠ¸ë§Œ ì ‘ê·¼)
#
# ========================================
